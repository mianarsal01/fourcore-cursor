{% assign default_value = app.metafields.fourcore_cursor.default_cursor.value | default: "cartoon-bag" %}
{% assign hover_value = app.metafields.fourcore_cursor.hover_cursor.value | default: "cartoon-bag-hover" %}
{% assign size_value = app.metafields.fourcore_cursor.cursor_size.value | default: 32 | plus: 0 %}
{% assign hover_size_value = app.metafields.fourcore_cursor.hover_cursor_size.value | default: size_value | plus: 0 %}
{% assign enabled_value = app.metafields.fourcore_cursor.enabled.value %}
{% if enabled_value == nil %}
  {% assign enabled_value = true %}
{% endif %}
{% assign disable_mobile_value = true %}
{% assign default_color = app.metafields.fourcore_cursor.default_color.value | default: "#ff7a59" %}
{% assign default_accent = app.metafields.fourcore_cursor.default_accent_color.value | default: "#ffd166" %}
{% assign hover_color = app.metafields.fourcore_cursor.hover_color.value | default: "#ff4d4d" %}
{% assign hover_accent = app.metafields.fourcore_cursor.hover_accent_color.value | default: "#ffe29a" %}
{% assign hotspot_x = app.metafields.fourcore_cursor.hotspot_x.value | default: 12 | plus: 0 %}
{% assign hotspot_y = app.metafields.fourcore_cursor.hotspot_y.value | default: 6 | plus: 0 %}
{% assign hover_hotspot_x = app.metafields.fourcore_cursor.hover_hotspot_x.value | default: hotspot_x | plus: 0 %}
{% assign hover_hotspot_y = app.metafields.fourcore_cursor.hover_hotspot_y.value | default: hotspot_y | plus: 0 %}

{% assign size_key = size_value | divided_by: 4 | round | times: 4 %}
{% if size_key < 24 %}
  {% assign size_key = 24 %}
{% endif %}
{% if size_key > 64 %}
  {% assign size_key = 64 %}
{% endif %}

{% assign hover_size_key = hover_size_value | divided_by: 4 | round | times: 4 %}
{% if hover_size_key < 24 %}
  {% assign hover_size_key = 24 %}
{% endif %}
{% if hover_size_key > 64 %}
  {% assign hover_size_key = 64 %}
{% endif %}

{% assign default_color_param = default_color | url_encode %}
{% assign default_accent_param = default_accent | url_encode %}
{% assign hover_color_param = hover_color | url_encode %}
{% assign hover_accent_param = hover_accent | url_encode %}

{% assign hotspot_x_px = hotspot_x | times: size_key | divided_by: 64 | round %}
{% assign hotspot_y_px = hotspot_y | times: size_key | divided_by: 64 | round %}
{% assign hover_hotspot_x_px = hover_hotspot_x | times: hover_size_key | divided_by: 64 | round %}
{% assign hover_hotspot_y_px = hover_hotspot_y | times: hover_size_key | divided_by: 64 | round %}

{% if default_value contains "http" %}
  {% assign default_url = default_value %}
{% else %}
  {% assign default_url = "/apps/fourcore-cursor/cursor?preset=" | append: default_value | append: "&state=default&size=" | append: size_key | append: "&color=" | append: default_color_param | append: "&accent=" | append: default_accent_param %}
{% endif %}

{% if hover_value contains "http" %}
  {% assign hover_url = hover_value %}
{% else %}
  {% assign hover_url = "/apps/fourcore-cursor/cursor?preset=" | append: default_value | append: "&state=hover&size=" | append: hover_size_key | append: "&color=" | append: hover_color_param | append: "&accent=" | append: hover_accent_param %}
{% endif %}

{% if enabled_value == true or enabled_value == "true" %}
    <style id="fourcore-cursor-style">
      * {
        cursor: inherit !important;
      }

      html, body, label {
        cursor: url("{{ default_url }}") {{ hotspot_x_px }} {{ hotspot_y_px }}, auto !important;
      }

      a:hover, textarea:hover, input:hover, select:hover, button:hover, summary:hover, [role='button']:hover {
        cursor: url("{{ hover_url }}") {{ hover_hotspot_x_px }} {{ hover_hotspot_y_px }}, auto !important;
      }

      html::before,
      html::after {
        content: "";
        position: fixed;
        width: 0;
        height: 0;
        overflow: hidden;
        opacity: 0;
        pointer-events: none;
      }

      html::before {
        background-image: url("{{ default_url }}");
      }

      html::after {
        background-image: url("{{ hover_url }}");
      }

      {% if disable_mobile_value == true or disable_mobile_value == "true" %}
      @media (pointer: coarse) {
        html, body, label,
        a:hover, textarea:hover, input:hover, select:hover, button:hover, summary:hover, [role='button']:hover {
          cursor: auto !important;
        }
      }
      {% endif %}
    </style>
{% endif %}

{% schema %}
{
  "name": "FourCore Custom Cursor",
  "target": "body",
  "settings": []
}
{% endschema %}
